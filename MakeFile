# -------------------------
# Configuration
# -------------------------
PYTHON ?= python
VENV := .venv
UV := uv

INPUT_DIR := input_files
OUTPUT_DIR := output_files

# OS detection
ifeq ($(OS),Windows_NT)
    RM_FILE = del /Q
    RM_DIR = rmdir /S /Q
    PY := $(VENV)\Scripts\python
    ACTIVATE = $(VENV)\Scripts\activate
else
    RM_FILE = rm -f
    RM_DIR = rm -rf
    PY := $(VENV)/bin/python
    ACTIVATE = source $(VENV)/bin/activate
endif

.PHONY: help venv install activate generate cleanup

# -------------------------
# Help
# -------------------------
help:
	@echo Available targets:
	@echo   make venv       - Create virtual environment using uv
	@echo   make install    - Install dependencies using uv
	@echo   make activate   - Show venv activation command
	@echo   make generate   - Run generation script
	@echo   make cleanup    - Remove generated files and folders

# -------------------------
# Virtual Environment
# -------------------------
venv:
	@echo Creating virtual environment with uv...
	$(UV) venv $(VENV)

# -------------------------
# Install Dependencies
# -------------------------
install: venv
	@echo Installing dependencies with uv...
	$(UV) pip install --upgrade pip
	$(UV) pip install -e .

# -------------------------
# Activation (informational)
# -------------------------
activate:
	@echo To activate the virtual environment, run:
	@echo $(ACTIVATE)

# -------------------------
# Generate
# -------------------------
generate: install
	@echo Generating output files...
	$(PY) scripts/generate.py

# -------------------------
# Cleanup
# -------------------------
cleanup:
	@echo Removing input .txt files...
	-$(RM_FILE) $(INPUT_DIR)\*.txt

	@echo Removing output folders...
	-$(RM_DIR) $(OUTPUT_DIR)\*

	@echo Cleanup complete.
